<h1>My Listings</h1>

<% if @listings.any? %>
  <ul>
    <% @listings.each do |listing| %>
      <li>
        <strong><%= listing.name %></strong>
        <p><%= listing.description %></p>
        <p><%= link_to 'View', listing_path(listing) %> |
    <% end %>
  </ul>
<% else %>
  <p>You have not created any listings yet.</p>
<% end %>


<h1>Booking requests</h1>


<% if current_user.listings.any? %>
  <% current_user.listings.each do |listing| %>
    <h2><%= listing.name %></h2>
    <ul>
      <% listing.bookings.each do |booking| %>
        <li><%= booking.user.email %></li>
        <li><%= booking.start_date %></li>
        <li><%= booking.end_date %></li>

        <% if listing.bookings.where(status: 'approved').none? && listing.bookings.where(status: 'pending').any? %>

            <%= link_to "Approve", my_bookings_approve_path(booking),
              method: :patch,
              data: { confirm: "Are you sure you want to approve this booking?" },
              class: "btn btn-success" %>


            <%= link_to "Deny", my_bookings_deny_path(booking),
              method: :patch,
              data: { confirm: "Are you sure you want to deny this booking?" },
              class: "btn btn-danger" %>

        <% end %>
      <% end %>
    </ul>
  <% end %>
<% end %>
